#import lib
import pandas as pd
from pandas import ExcelWriter
from pandas import ExcelFile
import numpy as np
import openpyxl
import regex

#to create an excel file
df=pd.DataFrame({'Student ID':[1,2,3,4,5],'Name':['Anu','Sita','Ram','Pia','Mini'],'Marks':[76,87,56,83,68]})
writer =ExcelWriter('excel1.xlsx')
df.to_excel(writer,'Sheet1',index=False)
writer.save()

#python program for import data from excel file
df1=pd.read_csv("train_titanic.csv")

#checking data types
df1.dtypes

#To format data in excel sheet
#conversion of object to string
df1['Ticket'] = df1['Ticket'].astype('string')

df1['Ticket']
#To format data in excel sheet
#conversion of object to string
df1['Ticket'] = df1['Ticket'].astype('string')

df1['Ticket'].dtype
#Rounding to two decimal places
df1['Fare'] = np.round(df1['Fare'],decimals = 2)

#conversion of object to string
df1['Cabin'] =df1['Cabin'].astype('string')
df1['Name'] =df1['Name'].astype('string')
df1['Sex'] =df1['Sex'].astype('string')

#searching any null value
df1.isnull().values.any()

#adding the null values
df1.isnull().sum()
#replacing null values with NaN
df1 =df1.replace(' ',np.nan)
df1.tail(10)

#filling of null values
df1.Age.fillna(value=df1.Age.mean(),inplace=True)
#Conversion of float to int
df1['Age']=df1['Age'].astype('int')

#Filling null values
df1.Cabin.fillna(df1.Cabin.mode()[0],inplace=True)
df1.Embarked.fillna(df1.Embarked.mode()[0],inplace=True)

#conversion of object to string
df1['Embarked'] =df1['Embarked'].astype('string')
#Rewritting dataframe to csv file
df1.to_csv("train_titanic2.csv", index=False)

# Defining file name and data
file_name = "chart2.xlsx"
file_data = (['Name', 'Marks'], ['Sam', 80], ['Samay', 90], ['Ram', 77], ['Shyam', 86])
xlsxfile = openpyxl.Workbook()
new_workbook = xlsxfile['Sheet']
for row, (Name,Marks) in enumerate(file_data, 1):
    new_workbook['A{}'.format(row)].value = Name
    new_workbook['B{}'.format(row)].value = Marks
xlsxfile.save(file_name)
excel_file_data = openpyxl.load_workbook(file_name)
excel_file_data.sheetnames
sheet_values = excel_file_data['Sheet']
for row in sheet_values:
    for cell in row: 
        print(cell.value)
# importing packages for bar chart
from openpyxl.chart import BarChart, Reference
chart = BarChart()
# Filling chart title,X axis title and Y axis title
chart.title = "Students and Marks"
chart.y_axis.title = 'Marks'
chart.x_axis.title = 'Name'
#creating a reference to the data and appending the data to the chart.
data = Reference(sheet_values, min_row=2, max_row=5, min_col=1, max_col=2)
chart.add_data(data, from_rows=True, titles_from_data=True)
#Adding the chart to the sheet and saving the file.
new_workbook.add_chart(chart, "D2")
xlsxfile.save(file_name)

# To extract mobile no from PDF,XML and MS Word file and save into MS excel
# extract mobile no from python
%config IPCompleter.greedy=True
import docx
# open connection to Word Document
doc = docx.Document("Word_file.docx")
# fetching paragraphs from word document
all_paras = doc.paragraphs
for para in all_paras:
    print(para.text)
mobile_list1=[]
for index, para in enumerate(doc.paragraphs):
    if(para.text):
        mobileNo = regex.search('\d{10}',para.text,regex.UNICODE)
        if mobileNo:
             mobile_list1.append(mobileNo.group(0))
print("Mobile No Present in the Word File :",mobile_list1)

# extract phone no from xml
from lxml import etree
doc = etree.parse('XMLFiles.xml')
mobile_list2=[ b.text for b in doc.iterfind('.//ContactNo') ]
print("Mobile no from XML file :",mobile_list2)

#extract phone no from pdf
import PyPDF2
import re

mobile_list3=[]
#for k in range(1,100):
# open the pdf file
object = PyPDF2.PdfFileReader("PDFfile.pdf")

# get number of pages
NumPages = object.getNumPages()

# extract text and do the search
for i in range(0, NumPages):
        PageObj = object.getPage(i)
        Text = PageObj.extractText() 
        ResSearch = re.search('\d{10}', Text)
        if ResSearch:
                mobile_list3.append(ResSearch.group(0))
print("Mobile No Present in the pdf File :",mobile_list3)

# storing the values of mobile numbers extracted from XML and word file in excel
df5 = pd.DataFrame.from_dict({'Mobile Number From Word File':mobile_list1,'Mobile Number From XML File':mobile_list2})
df5.to_excel('Mobile No1.xlsx', header=True, index=False)

